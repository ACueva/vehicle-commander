<project name="ArcGIS Versions" default="set_version_variables" basedir=".">
    <description>
	OUTPUTS: ${version.runtime}, ${dir.agsruntimejavasdk}
	Checks filesystem and sets the correct values depending on version detected.
        Checks based on the default SDK folder locations and verifies that the folder exists
	If 2 versions are installed, it uses the current version first
        IMPORTANT: If ArcGIS is not installed at the default location,
                   you will need to edit the value at task "SET_CUSTOM_AGS_RUNTIME_LOCATION"
    </description>
	
<!-- Set these to the default locations of ArcGIS/ArcPy for the current version (ex. 10.2): -->
<property name="version.runtime_current_release" value="10.2"/>

<!-- Set these to the default locations for the previous release (ex. 10.1.1): -->
<property name="version.runtime_previous_release" value="10.1.1"/>

<!-- Set these to the default locations for the platform (win vs. linux): -->
<property name="dir_agsruntime_win_base" value="C:\Program Files (x86)\ArcGIS SDKs"/>
<property name="dir_agsruntime_linux_base" value="${user.home}/arcgis/runtime_sdk"/>

<!-- ************************************************************************************************************ -->
<!-- IMPORTANT: If you have *NOT* installed ArcGIS to the default install location, you will need to set the following: -->
<!-- If you want to use a custom AGS Location Uncomment the line below and set the values in the "SET_CUSTOM_AGS_RUNTIME_LOCATION" target -->
<!-- EXTRA IMPORTANT: UNCOMMENT THIS PROPERTY if you need a custom SDK location: -->
  <!-- <property name="USE_CUSTOM_AGS_LOCATION" value="true"/> -->
<!-- SET THESE VALUES TO YOUR CUSTOM INSTALL LOCATION: -->
<target name="SET_CUSTOM_AGS_RUNTIME_LOCATION" if="USE_CUSTOM_AGS_LOCATION">
	<echo message="Setting Custom Values for ArcGIS Runtime"/>
	<property name="version.runtime" value="10._SET_ME_"/>
	<property name="dir.agsruntimejavasdk" value="_SET_ME_EX_/home/arcgis/runtime_sdk/java10._SET_ME_"/> <!-- CHANGE TO YOUR LOCATION -->
</target>
<!-- ************************************************************************************************************* -->

<!-- Check for Windows or Linux -->
<target name="checkWindows">
  <condition property="PresentOnWindows">
    <available file="${dir_agsruntime_win_base}" type="dir"/>
  </condition>
</target>

<target name="checkLinux">
  <condition property="PresentOnLinux">
    <available file="${dir_agsruntime_linux_base}" type="dir"/>
  </condition>
</target>

<target name="setBaseFoldersWin" depends="checkWindows" if="PresentOnWindows">
  <property name="dir_agsruntimejava_current_release" value="${dir_agsruntime_win_base}\java${version.runtime_current_release}"/>
  <property name="dir_agsruntimejava_previous_release" value="${dir_agsruntime_win_base}\java${version.runtime_previous_release}"/>
</target>

<target name="setBaseFoldersLinux" depends="checkLinux" if="PresentOnLinux">
  <property name="dir_agsruntimejava_current_release" value="${dir_agsruntime_linux_base}/java${version.runtime_current_release}"/>
  <property name="dir_agsruntimejava_previous_release" value="${dir_agsruntime_linux_base}/java${version.runtime_previous_release}"/>
</target>

<target name="checkWindowsOrLinux" depends="setBaseFoldersWin,setBaseFoldersLinux">
  <condition property="platformnotfound">
    <and>
      <not>
        <isset property="PresentOnWindows"/>
      </not>
      <not>
        <isset property="PresentOnLinux"/>
      </not>      
    </and>
   </condition>
   <fail message="**** COULD NOT FIND *DEFAULT* ArcGIS Runtime SDK INSTALLATION FOLDER ****" if="platformnotfound"/>	
</target>

<!-- Check for version installed -->

<target name="checkdirCurrentVersion" depends="checkWindowsOrLinux">
	<condition property="PresentCurrentVersion">
		<available file="${dir_agsruntimejava_current_release}" type="dir"/>
	</condition>
</target>

<target name="checkdirPreviousVersion" depends="checkWindowsOrLinux">
	<condition property="PresentPreviousVersion">
		<available file="${dir_agsruntimejava_previous_release}" type="dir"/>
	</condition>
</target>
 
<target name="setvariablesCurrentVersion" depends="checkdirCurrentVersion" if="PresentCurrentVersion">
	<echo message="Current version of ArcGIS detected at its default location."/>
	<property name="dir.agsruntimejavasdk" value="${dir_agsruntimejava_current_release}"/>
	<property name="version.runtime" value="${version.runtime_current_release}"/>
</target>

<target name="setvariablesPreviousVersion" depends="checkdirPreviousVersion" if="PresentPreviousVersion">
	<echo message="Previous version of ArcGIS detected at its previous location."/>
	<property name="dir.agsruntimejavasdk" value="${dir_agsruntimejava_previous_release}"/>
	<property name="version.runtime" value="${version.runtime_previous_release}"/>
</target>

<!-- Check that expected variables exists -->

<target name="check_agsruntime_sdk_exists" depends="SET_CUSTOM_AGS_RUNTIME_LOCATION,setvariablesCurrentVersion,setvariablesPreviousVersion">
	<echo message="Checking for ArcGIS Runtime SDK at these Locations: ${dir.agsruntimejavasdk}"/>	
	<condition property="agsnotfound">
	    <or>
		<not>
			<isset property="dir.agsruntimejavasdk"/>
		</not>
      		<not>
		        <available file="${dir.agsruntimejavasdk}" type="dir"/>
		</not>       
	    </or>
	</condition>
	<fail message="**** COULD NOT FIND VALID ArcGIS Runtime SDK INSTALLATION FOLDER ****" if="agsnotfound"/>	
</target>

<target name="set_version_variables" depends="check_agsruntime_sdk_exists">
	<echo message="ArcGIS Runtime SDK found at this locations: ${dir.agsruntimejavasdk}" />
	<echo message="ArcGIS Runtime Version: ${version.runtime}" />
</target>

</project>

